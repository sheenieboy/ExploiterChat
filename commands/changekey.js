const Discord = require('discord.js');

module.exports = {
	name: 'changekey',
	aliases: ['changekey'],
	description: "Change ExploiterChat login key",
    usage: '<New Key>',
    moderatorsOnly: false,
	ownerOnly: false,
	guildOnly: false,
	cooldown: 3,
	run(client, msg, args, con) {
        if(msg.channel.type === 'dm') {
            con.query("SELECT `id` FROM `Users` WHERE `DiscordID` = '" + msg.author.id + "' LIMIT 1", function (err, result) {
                if (result.length) {
                    const newUniqueCode = args[0].replace(/[^\w\s]/gi, '')
                    if(newUniqueCode.length >= 5) {
                        msg.channel.send(`Your Key/Password for ExploiterChat has been updated`);
                        con.query("UPDATE `Users` SET `UniqueCode` = '" + newUniqueCode + "' WHERE `id` = '" + result[0].id + "'", function (err, result) { if (err) console.log(err); });
                    } else { msg.channel.send(`Memorable Key needs to be 5 or more characters`); }
                } else { msg.channel.send(`Discord not linked to ExploiterChat`); }
            });
        } else { msg.reply(`Please do this command in my DMs to keep your account safe!`); }
    }
};