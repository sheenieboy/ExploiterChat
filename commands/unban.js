const Discord = require('discord.js');
const moment = require('moment')
module.exports = {
    name: 'unban',
    aliases: ['unban'],
    description: 'Unban a user!',
    usage: '<DiscordID>',
    cooldown: 2,
    moderatorsOnly: true,
    ownerOnly: false,
    guildOnly: true,
    async run(client, message, args, con) {
        if(!args[0]) return message.channel.send('Please specify a user');
        var id = args[0];
        con.query("SELECT `Username` FROM `Users` WHERE `DiscordID` = '" + id + "'", function (err, discordC) {
            if(discordC.length) {
                con.query("UPDATE `Users` SET `Banned` = false WHERE `DiscordID` = '" + id + "'", function (err, result) { if (err) console.log(err); });
                con.query("INSERT INTO `ModeratorLogs` (`Username`,`Action`,`Time`,`IpAddress`) VALUES ('DiscordID: " + message.author.id + "','Un-Banned user: " + discordC[0].Username + "','" + moment().format('YYYY-MM-DD HH:mm:ss') + "','From Discord')", function (err, result) { if (err) console.log(err); });
            } else {
                con.query("SELECT `Username` FROM `Users` WHERE `Username` = '" + id + "'", function (err, discordC) {
                    if(discordC.length) {
                        con.query("UPDATE `Users` SET `Banned` = false WHERE `Username` = '" + id + "'", function (err, result) { if (err) console.log(err); });
                        con.query("INSERT INTO `ModeratorLogs` (`Username`,`Action`,`Time`,`IpAddress`) VALUES ('DiscordID: " + message.author.id + "','Un-Banned user: " + discordC[0].Username + "','" + moment().format('YYYY-MM-DD HH:mm:ss') + "','From Discord')", function (err, result) { if (err) console.log(err); });
                    }
                });
            }
        });
        message.guild.members.unban(id)
        return message.reply('Unbanned user!'); 
    }
};