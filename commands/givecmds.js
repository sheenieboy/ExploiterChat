const Discord = require('discord.js');
const moment = require('moment')
module.exports = {
    name: 'givecmds',
    aliases: ['givecmds'],
    description: "Give a player ingame moderator commands",
    usage: '<@Username>',
    moderatorsOnly: true,
    ownerOnly: true, 
    guildOnly: true,
    cooldown: 3,
    run(client, msg, args, con) {
        var taggedUser = msg.mentions.members.first();
        if (!taggedUser) {
            if(msg.guild.members.cache.get(args[0])) {
                taggedUser = msg.guild.members.cache.get(args[0]);
            }
        }
        if(taggedUser) { 
            con.query("SELECT `Username` FROM `Users` WHERE `DiscordID` = '" + taggedUser.id + "'", function (err, discordC) {
                if(discordC.length) {
                    con.query("UPDATE `Users` SET `Commands` = 1 WHERE `DiscordID` = '" + taggedUser.id + "'", function (err, result) { if (err) console.log(err); });
                    con.query("INSERT INTO `ModeratorLogs` (`Username`,`Action`,`Time`,`IpAddress`) VALUES ('DiscordID: " + msg.author.id + "','Given ingame mod commands to: " + taggedUser.id + "','" + moment().format('YYYY-MM-DD HH:mm:ss') + "','From Discord')", function (err, result) { if (err) console.log(err); });
                    msg.channel.send(`${taggedUser.username} has been give moderator powers ingame`)//.then(Message => { Message.delete({timeout: 5000})});
                }
            });
        } else {
            con.query("SELECT `DiscordID` FROM `Users` WHERE `Username` = '" + args[0] + "'", function (err, discordC) {
                if(discordC.length) {
                    taggedUser = msg.guild.members.cache.get(discordC[0].DiscordID);
                    con.query("UPDATE `Users` SET `Commands` = 1 WHERE `Username` = '" + args[0] + "'", function (err, result) { if (err) console.log(err); });
                    con.query("INSERT INTO `ModeratorLogs` (`Username`,`Action`,`Time`,`IpAddress`) VALUES ('DiscordID: " + msg.author.id + "','Given ingame mod commands to: " + args[0] + "','" + moment().format('YYYY-MM-DD HH:mm:ss') + "','From Discord')", function (err, result) { if (err) console.log(err); });
                    msg.channel.send(`${args[0]} has been give moderator powers ingame`)//.then(Message => { Message.delete({timeout: 5000})});
                }
            });
        }
    }
};