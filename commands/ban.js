const Discord = require('discord.js');
const moment = require('moment')
module.exports = {
    name: 'ban',
    aliases: ['ban'],
    description: 'Ban a user!',
    usage: '$ban <Username>',
    cooldown: 2,
    moderatorsOnly: true,
    ownerOnly: true,
    guildOnly: true,
    async run(client, message, args, con) {
        var taggedUser = message.mentions.members.first();
        if (!taggedUser) {
            try {
                if(!message.guild.members.cache.get(args[0])) throw new Error('Couldnt find user!');
                taggedUser = message.guild.members.cache.get(args[0]);
                taggedUser = taggedUser.user
            } catch (error) {
                return message.reply('Couldnt find user!');
            }
        }
        if (!message.guild.member(taggedUser).bannable) {
            return message.reply('You can\'t ban this user because you the bot has not sufficient permissions!'); 
        }
       
        if(taggedUser) {
            taggedUser.ban()
        }
        con.query("SELECT `Username` FROM `Users` WHERE `DiscordID` = '" + taggedUser.id + "'", function (err, discordC) {
            if(discordC.length) {
                con.query("UPDATE `Users` SET `Banned` = true WHERE `DiscordID` = '" + taggedUser.id + "'", function (err, result) { if (err) console.log(err); });
                con.query("INSERT INTO `ModeratorLogs` (`Username`,`Action`,`Time`,`IpAddress`) VALUES ('DiscordID: " + message.author.id + "','Banned user: " + discordC[0].Username + "','" + moment().format('YYYY-MM-DD HH:mm:ss') + "','From Discord')", function (err, result) { if (err) console.log(err); });
            }
        });
    },
};