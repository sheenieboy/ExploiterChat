const Discord = require('discord.js');
module.exports = {
    name: 'purge',
    aliases: ['purge'],
    description: 'Delete bulk messages!',
    usage: '<Number>',
    cooldown: 2,
    moderatorsOnly: false,
    ownerOnly: true,
    guildOnly: false,
    async run(client, message, args, con) {
        const deleteCount = parseInt(args[0], 10);
        if(!deleteCount || deleteCount < 1 || deleteCount > 100)
        return message.reply("Please provide a number between 1 and 100 for the number of messages to delete");

        con.query("SELECT * FROM `Users` WHERE `DiscordID` = '" + message.author.id + "'", async function (err, result) {
            if (result.length) {
                global.WebSocket.clients.forEach(function each(ws) {
                    ws.send(JSON.stringify({'Action': 'PurgeChat', 'Amount': deleteCount, 'Username': result[0].Username, 'UniqueCode': result[0].UniqueCode}));
                });
                const fetched = await message.channel.messages.fetch({limit: deleteCount});
                message.channel.send(fetched.size + ` deleted messages by ${message.author.tag}`).then(msg => {msg.delete({ timeout: 2000 })});
                message.channel.bulkDelete(fetched)
            }
        });
    },
};