const Discord = require('discord.js');
module.exports = {
    name: 'link',
    aliases: ['link'],
    description: 'Link your account to exploiter chat!',
    usage: '$link <Username> <Key>',
    cooldown: 2,
    moderatorsOnly: false,
    ownerOnly: false,
    guildOnly: false,
    async run(client, message, args, con) {
        if(message.channel.type === 'dm') {
            const Username = args[0];
            const UniqueCode = args[1];
            con.query("SELECT `Username` FROM `Users` WHERE `DiscordID` = '" + message.author.id + "'", function (err, discordC) {
                if(!discordC.length) {
                    con.query("SELECT `Username` FROM `Users` WHERE `Username` = '" + Username + "' AND `UniqueCode` = '" + UniqueCode + "' LIMIT 1", function (err, result) {
                        if(err) return console.log(err);
                        if (result.length) {
                            con.query("UPDATE `Users` SET `DiscordID` = '" + message.author.id + "' WHERE `Username` = '" + Username + "'", function (err, result) { if(err) return console.log(err); });
                            message.reply(`Successfully connected your discord account to your Exploiter Chat account!`);
                            var User = client.guilds.cache.get("789295332378148914").members.cache.get(message.author.id);
                            if(User) { 
                                User.roles.add('798898560862388244')
                            }
                        } else {
                            message.reply(`Account details dont match. Please use the command as follows; $link username password! You can get your password by saying ;uniquekey in ExploiterChat`);
                        }
                    });
                } else {
                    message.reply(`Your discord is already linked to an account!`);
                }
            });
        } else {
            message.reply(`Please do this command in my DMs to keep your account safe!`);
            message.delete();
        }
    },
};